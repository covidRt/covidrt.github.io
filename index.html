  <!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>COVID Rt</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  </head>
  <body>

    <p><font size="80px">
      20200831時点<br>
      カリフォルニア州<br>
      実行再生産数: 0.87<br>
      新規感染者（7日間平均）：5,067人</font></p>

    <!-- <p id='date'>20200831</p>
    <p id='rt'>0.87</p>
    <p id='seveAve'>0.87</p> -->

    
  <script>
  const endpoint = 'https://api.covidtracking.com/v1/states/ca/daily.json';

  const metaData = [];
  fetch(endpoint)
    .then(blob => blob.json())
    .then(data => metaData.push(...data));



  const result = [];
  const arr = [];
  const senvenDaverage = []
  const cummulateError = [
    0.037, 0.138, 0.160, 0.142, 0.117, 0.094, 0.075, 0.059, 0.047, 0.038, 0.031, 0.025, 0.021, 0.017
  ]

  function fourteenDaysArray(metaData){
    for(let i = 1; i < 15; ++i){
      const foureteenDaysArr = Array.of(
        metaData[i].positiveIncrease,
        metaData[i+1].positiveIncrease,
        metaData[i+2].positiveIncrease,
        metaData[i+3].positiveIncrease,
        metaData[i+4].positiveIncrease,
        metaData[i+5].positiveIncrease,
        metaData[i+6].positiveIncrease
        ).reduce((acc, cur) => acc + cur) / 7;
        result.push(foureteenDaysArr)
    }
    console.log(result)
    for(let i =0; i<14; ++i){
        const x = result[i] * cummulateError[i];
        arr.push(x)
        }
    console.log(arr)
    const sum = function(arr){
      return arr.reduce((acc, cur) => acc + cur)
    }
    console.log(sum(arr))
    
    const sevenDaysAve = metaData.map(x =>  x.positiveIncrease).splice(0,7).reduce((acc, cur) => acc + cur) / 7
    
    console.log(sevenDaysAve)
    const Rt = sevenDaysAve / sum(arr);
    console.log(Rt)

    // const pdate = document.getElementById("date");
    // pdate.textContent = `${metaData[1].date}`

    // const elem = document.getElementById("rt");
    // elem.textContent = `${Math.round(Rt * 100) /100}`

  }



  function displayRt(metaData){
    console.log(fourteenDaysArray(metaData))
  }

  window.addEventListener('DOMContentLoaded', displayRt)


  </script>
  </body>
  </html>

